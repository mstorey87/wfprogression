% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/fire_barra_sample.R
\name{fire_barra_sample}
\alias{fire_barra_sample}
\title{#' Function to stream and sample BARRA weather netcdf
#'
#' @description
#' Take an existing nc connection (tidync::tidync()) and sample for the locations in the input sf points
#' see end of this document for variable names http://www.bom.gov.au/research/publications/researchreports/BRR-067.pdf
#' example here of R2 variables on thredds https://thredds.nci.org.au/thredds/catalog/ob53/output/reanalysis/AUS-11/BOM/ERA5/historical/hres/BARRA-R2/v1/1hr/catalog.html
#' some variables are sfcWind (surface wind), tas (temperature), hurs (RH), vas and uas (wind components). These are the values on the hour. Some variables
#' @param nc_conn netcdf connection using tidync::tidync()
#' @param datetimeutc posixct datetime in utc. Must match https path of nc connection
#' @param sf_data sf object with one row with locations to sample barra data
Function to stream and sample BARRA weather netcdf}
\usage{
fire_barra_sample(
  nc_conn,
  datetimeutc,
  sf_data,
  varname,
  return_rast = FALSE,
  allcells = FALSE,
  timestep,
  extract_fun = "mean"
)
}
\arguments{
\item{nc_conn}{NetCDF connection created with \code{tidync::tidync()}}

\item{datetimeutc}{POSIXct datetime in UTC; must match time dimension in NetCDF connection}

\item{sf_data}{\code{sf} object (typically points or polygons) with locations to sample}

\item{varname}{Character; BARRA variable name matching variable in NetCDF (e.g. "sfcWind", "tas")}

\item{return_rast}{Logical; if TRUE, a terra spatrast is returned. If FALSE, a data frame of sampled
values are returned.}

\item{allcells}{Logical; if TRUE returns all intersecting cells in BARRA data for polygons;
if FALSE (default), returns summarized value (e.g. mean) for points or polygons}

\item{timestep}{Character; one of "hourly", "daily", or "monthly". Determines time filtering.}

\item{extract_fun}{Character or function; summary function used by \code{terra::extract()} when \code{allcells=FALSE}}
}
\value{
An \code{sf} object with new columns containing sampled variable data
}
\description{
Takes an existing NetCDF connection (created via \code{tidync::tidync()}) and samples
the specified BARRA variable for the locations in the input \code{sf} object.

Variable names and details can be found here:
http://www.bom.gov.au/research/publications/researchreports/BRR-067.pdf

Example of R2 variables on THREDDS:
https://thredds.nci.org.au/thredds/catalog/ob53/output/reanalysis/AUS-11/BOM/ERA5/historical/hres/BARRA-R2/v1/1hr/catalog.html

Common variables include:
\itemize{
\item \code{sfcWind} (surface wind)
\item \code{tas} (temperature)
\item \code{hurs} (relative humidity)
\item \code{vas} and \code{uas} (wind components)
}
}
\examples{
\dontrun{
library(tidync)
library(sf)

# Create NetCDF connection to a BARRA R2 variable (e.g., sfcWind)
nc <- tidync("https://thredds.nci.org.au/thredds/dodsC/ob53/output/reanalysis/AUS-11/BOM/ERA5/historical/hres/BARRA-R2/v1/1hr/sfcWind/latest/sfcWind_AUS-11_ERA5_historical_hres_BOM_BARRA-R2_v1_1hr_201912-201912.nc")

# Create example sf points near Canberra
pts <- sf::st_sf(
  id = 1,
  geometry = sf::st_sfc(sf::st_point(c(149.1, -35.3)), crs = 4326)
)

# Sample data for given datetime and points
res <- fire_barra_sample(
  nc_conn = nc,
  datetimeutc = as.POSIXct("2019-12-01 10:00:00", tz = "UTC"),
  sf_data = pts,
  varname = "sfcWind",
  allcells = FALSE,
  timestep = "hourly",
  extract_fun = "mean"
)
}
}
